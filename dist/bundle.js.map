{"version":3,"sources":["webpack:///webpack/bootstrap cd4475d7fdf347b166e0","webpack:///./src/pack.js","webpack:///./src/instance.ts","webpack:///./src/task.ts","webpack:///./src/request.ts","webpack:///./src/queue.ts"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;AACA;;;;;;;ACDA;AACA,YAAW,eAAe;AAC1B;AACA;AACA;AACA,YAAW,YAAY;AACvB,YAAW,cAAc;AACzB;AACA;AACA;AACA;AACA;AACA,gDAA+C,yBAAyB;AACxE;AACA;AACA;AACA;AACA;AACA;AACA,aAAY,UAAU;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD;;;;;;;AC3CA,YAAW,aAAa;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;;;;;;;ACnBA;AACA;AACA;AACA;AACA;AACA,sDAAqD;AACrD,kDAAiD;AACjD;AACA;AACA,EAAC;AACD;;;;;;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,EAAC;AACD","file":"./dist/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap cd4475d7fdf347b166e0\n **/","window.Cyako = require(\"./instance\").CyakoInstance;\n// window.cyako = require(\"./instance\").CyakoInstance;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/pack.js\n ** module id = 0\n ** module chunks = 0\n **/","\"use strict\";\n// import {CyakoConnector} from \"./connector\";\nvar task_1 = require(\"./task\");\nvar request_1 = require(\"./request\");\nvar queue_1 = require(\"./queue\");\n// import {CyakoSender} from \"./sender\";\n// import {CyakoReceiver} from \"./receiver\";\nvar CyakoInstance = (function () {\n    function CyakoInstance(url) {\n        this.url = url;\n        this.websocket;\n        this.queue = new queue_1.CyakoQueue();\n        // this.socket = new socket((socket)=>{this.websocket = socket;});\n        this.receiver = new CyakoReceiver(this.queue);\n        this.socket = new CyakoSocket(this.url, this.receiver);\n        this.sender = new CyakoSender(this.queue, this.socket);\n        // initial\n        // this.connector.connect().then((ok)=>{\n        // \tthis.bindEvents();\n        // },(err)=>{});\n    }\n    ;\n    // API\n    CyakoInstance.prototype.fetch = function (method, params, data) {\n        var _this = this;\n        var request = new request_1.CyakoRequest(method, params, data);\n        return new Promise(function (resolve, rejecct) {\n            var task = new task_1.CyakoTask(type, 'single', request, request, onresolve, resolve, onreject, rejecct);\n            _this.queue.add(task);\n            _this.sender.send();\n        });\n    };\n    CyakoInstance.prototype.listen = function (method, params, data) {\n        var _this = this;\n        var request = new request_1.CyakoRequest(method, params, data);\n        return new Promise(function (resolve, rejecct) {\n            var task = new task_1.CyakoTask(type, 'multiple', request, request, onresolve, resolve, onreject, rejecct);\n            _this.queue.add(task);\n            _this.sender.send();\n        });\n    };\n    return CyakoInstance;\n}());\nexports.CyakoInstance = CyakoInstance;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/instance.ts\n ** module id = 1\n ** module chunks = 0\n **/","// import {CyakoRequest} from \"./request\"\n\"use strict\";\nvar CyakoTask = (function () {\n    function CyakoTask(type, request, resolve, reject) {\n        this.id = request.id;\n        this.type = type;\n        this.request = request;\n        this.onresolve = resolve;\n        this.onreject = reject;\n        // this.time = new Date().now();\n    }\n    CyakoTask.prototype.expectMultiResponses = function () {\n        return this.type === 'multiple';\n    };\n    CyakoTask.prototype.isTimeout = function () {\n        return false;\n    };\n    return CyakoTask;\n}());\nexports.CyakoTask = CyakoTask;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/task.ts\n ** module id = 2\n ** module chunks = 0\n **/","\"use strict\";\nvar CyakoRequest = (function () {\n    function CyakoRequest(id, method, params, data) {\n        this.id = id || Date.now();\n        this.method = method,\n            this.params = JSON.stringify(params || {}),\n            this.data = JSON.stringify(data || {});\n    }\n    return CyakoRequest;\n}());\nexports.CyakoRequest = CyakoRequest;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/request.ts\n ** module id = 3\n ** module chunks = 0\n **/","\"use strict\";\nvar CyakoQueue = (function () {\n    function CyakoQueue() {\n        this.unsent = new Map();\n        this.sent = new Map();\n        // this.finished = new Map();\n    }\n    // _addTask()\n    // addSingleRespTask(task){}\n    // removeSingleRespTask(){}\n    // addMultiRespTask(){}\n    // removeMultiRespTask(){}\n    // addTask(){}\n    // removeTask(){}\n    // resolveResp(){}\n    // clean()\n    CyakoQueue.prototype.add = function (task) {\n        this.unsent.set(task.id, task);\n    };\n    CyakoQueue.prototype.get = function (taskId) {\n        return this.sent.get(taskId);\n    };\n    CyakoQueue.prototype.setSent = function (taskId) {\n        if (this.unsent.has(taskId)) {\n            this.sent.set(taskId, this.unsent.get(taskId));\n            this.unsent.delete(taskId);\n        }\n    };\n    CyakoQueue.prototype.setFinished = function (taskId) {\n        if (this.sent.has(taskId)) {\n            this.sent.delete(taskId);\n        }\n    };\n    CyakoQueue.prototype.clean = function () {\n        var timeout = 10000;\n        var op = function (sent) {\n            var entries = sent.entries();\n            var item = entries.next();\n            while (!item.done) {\n                var task = item.value;\n                if (task.isTimeout()) {\n                    sent.delete(item.key);\n                }\n                item = entries.next();\n            }\n        };\n        setTimeout(function () {\n            op();\n        }, timeout);\n    };\n    return CyakoQueue;\n}());\nexports.CyakoQueue = CyakoQueue;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/queue.ts\n ** module id = 4\n ** module chunks = 0\n **/"],"sourceRoot":""}