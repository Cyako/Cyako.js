{"version":3,"sources":["webpack:///webpack/bootstrap bb959d55dc0167075431","webpack:///./src/pack.js","webpack:///./src/instance.ts","webpack:///./src/request.ts","webpack:///./src/task.ts","webpack:///./src/queue.ts","webpack:///./src/sender.ts","webpack:///./src/receiver.ts","webpack:///./src/socket.ts"],"names":[],"mappings":"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","file":"./dist/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap bb959d55dc0167075431\n **/","window.Cyako = require(\"./instance\").CyakoInstance;\nwindow.cyako = require(\"./instance\").CyakoInstance;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/pack.js\n ** module id = 0\n ** module chunks = 0\n **/","import {CyakoRequest} from \"./request\";\nimport {CyakoTask} from \"./task\";\nimport {CyakoQueue} from \"./queue\";\nimport {CyakoSender} from \"./sender\";\nimport {CyakoReceiver} from \"./receiver\";\nimport {CyakoSocket} from \"./socket\";\n\nexport class CyakoInstance {\n    // public websocket;\n    public url: string;\n    public queue: CyakoQueue;\n    public receiver: CyakoReceiver;\n    public sender: CyakoSender;\n    public socket: CyakoSocket;\n    private index: number;\n    constructor(url:string) {\n        this.url=url;\n    \tthis.queue = new CyakoQueue();\n    \t// this.socket = new socket((socket)=>{this.websocket = socket;});\n    \tthis.receiver = new CyakoReceiver(this.queue);\n    \tthis.socket = new CyakoSocket(this.url,this.receiver);\n    \tthis.sender = new CyakoSender(this.queue,this.socket);\n        this.index = 0;\n    };\n\n    // API\n    fetch(method:string,params:Object,data:Object){\n    \tlet request = new CyakoRequest(method,params,data);\n        request.setId(\"#\" + this.index++ + \":\" + method);\n    \treturn new Promise((resolve,rejecct) => {\n    \t\tlet task = new CyakoTask('single',request,resolve,rejecct);\n    \t\tthis.queue.add(task);\n    \t\tthis.sender.send();\n    \t});\n    }\n    \n    listen(method: string, params: Object, data: Object) {\n    \tlet request = new CyakoRequest(method,params,data);\n        request.setId(\"#\" + this.index++ + \":\" + method);\n        return new Listener(this.queue,this.sender,request);\n    }\n}\n\nclass Listener{\n    public promise: any;\n    public isPause: boolean;\n    public task: CyakoTask;\n    public queue: CyakoQueue;\n    public sender: CyakoSender;\n    constructor(queue:CyakoQueue,sender:CyakoSender,request:CyakoRequest){\n        this.queue = queue;\n        this.sender = sender;\n        this.isPause = false;\n        this.promise = new Promise((resolve, rejecct) => {\n            this.task = new CyakoTask('multiple', request, resolve, rejecct);\n            this.queue.add(this.task);\n            this.sender.send()\n        });\n    }\n    pause(){\n        this.task.pause();\n    }\n    continue(){\n        this.task.continue();\n    }\n    cancel(){\n        this.queue.setFinished(this.task.id);\n    }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/instance.ts\n **/","export class CyakoRequest{\n\tpublic id: string;\n\tpublic method: string;\n\tpublic params: Object;\n\tpublic data: Object;\n\tconstructor(method:string, params:Object, data:Object){\n\t\tthis.method = method,\n\t\tthis.params = params,\n\t\tthis.data = data\n\t}\n\tsetId(id:string){\n\t\tthis.id = id;\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/request.ts\n **/","import {CyakoRequest} from \"./request\"\n\nexport class CyakoTask{\n\tpublic id: string;\n\tpublic type: string;\n\tpublic request: CyakoRequest;\n\tpublic acceptResolve: boolean;\n\tpublic onresolve: Function;\n\tpublic onreject: Function;\n\tconstructor(type :string,request:CyakoRequest,resolve:Function,reject:Function){\n\t\tthis.id = request.id;\n\t\tthis.type = type;\n\t\tthis.request = request;\n\t\tthis.acceptResolve = true;\n\t\tthis.onresolve = resolve;\n\t\tthis.onreject = reject;\n\t\t// this.createTime = new Date().toUTCString();\n\t}\n\texpectMultiResponses(){\n\t\treturn this.type === 'multiple';\n\t}\n\tpause() {\n\t\tthis.acceptResolve = false;\n\t}\n\tcontinue() {\n\t\tthis.acceptResolve = true;\n\t}\n\tisTimeout(){\n\t\treturn false;\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/task.ts\n **/","import {CyakoTask} from \"./task\";\n\nexport class CyakoQueue{\n\tpublic unsent: any;\n\tpublic sent: any;\n\tconstructor(){\n\t\tthis.unsent = new Map();\n\t\tthis.sent = new Map();\n\t\t// this.finished = new Map();\n\t}\n\tadd(task:CyakoTask){\n\t\tthis.unsent.set(task.id,task);\n\t}\n\tget(taskId:string){\n\t\treturn this.sent.get(taskId);\n\t}\n\tsetSent(taskId:string){\n\t\tif (this.unsent.has(taskId)){\n\t\t\tthis.sent.set(taskId,this.unsent.get(taskId));\n\t\t\tthis.unsent.delete(taskId)\n\t\t}\n\t}\n\tsetFinished(taskId:string){\n\t\tif (this.sent.has(taskId)) {\n\t\t\tthis.sent.delete(taskId)\n\t\t}\n\t}\n\tclean(){\n\t\tlet timeout = 10000;\n\t\tlet op = (sent:any) => {\n\t\t\tlet entries = sent.entries(); \n\t\t\tlet item = entries.next();\n\t\t\twhile(!item.done){\n\t\t\t\tlet task = item.value;\n\t\t\t\tif (task.isTimeout()) {\n\t\t\t\t\tsent.delete(item.key)\n\t\t\t\t}\n\t\t\t\titem = entries.next();\n\t\t\t}\n\t\t};\n\t\tsetTimeout(()=>{\n\t\t\top(this.sent);\n\t\t},timeout)\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/queue.ts\n **/","import {CyakoQueue} from \"./queue\";\nimport {CyakoSocket} from \"./socket\";\n\nexport class CyakoSender {\n\tpublic queue: CyakoQueue;\n\tpublic socket: CyakoSocket;\n\tconstructor(queue:CyakoQueue,socket:CyakoSocket){\n\t\tthis.queue = queue;\n\t\tthis.socket = socket;\n\t}\n\tpublic send(){\n\t\tlet sendUnsent = () => {\n\t\t\tlet entries = this.queue.unsent.entries();\n\t\t\tlet item = entries.next();\n\t\t\twhile(!item.done){\n\t\t\t\tlet task = item.value[1];\n\t\t\t\tthis.socket.send(task.request);\n\t\t\t\tthis.queue.setSent(task.id);\n\t\t\t\titem = entries.next();\n\t\t\t}\n\t\t};\n\t\tif (this.socket.isConnected()){\n\t\t\tsendUnsent();\n\t\t}else{\n\t\t\tthis.socket.connect().then(ok=>{\n\t\t\t\tsendUnsent();\n\t\t\t},err=>{});\n\t\t}\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/sender.ts\n **/","import {CyakoQueue} from \"./queue\";\n\nexport class CyakoReceiver{\n\tpublic queue: CyakoQueue;\n\tconstructor(queue:CyakoQueue){\n\t\tthis.queue = queue;\n\t}\n\tresolve(response:Response){\n\t\tconsole.log(\"RESOLVING:\", response.id);\n\t\tlet id = response.id;\n\t\tlet task = this.queue.get(id);\n\t\tif (task && task.acceptResolve) {\n\t\t\ttask.onresolve(response);\n\t\t\tif (!task.expectMultiResponses()) {\n\t\t\t\tthis.queue.setFinished(id);\n\t\t\t}\n\t\t}\n\t};\n}\n\ninterface Response{\n\tid:string\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/receiver.ts\n **/","import {CyakoReceiver} from \"./receiver\";\nimport {CyakoRequest} from \"./request\";\n\nexport class CyakoSocket{\n\tpublic url: string;\n\tpublic receiver: CyakoReceiver;\n\tpublic websocket: WebSocket;\n\t// constructor(url,callback){\n\tconstructor(url:string,receiver:CyakoReceiver){\n\t\tthis.url = url;\n\t\tthis.receiver = receiver;\n\t\t// this.socketCallback = callback;\n\t\t// this.websocket;\n\t}\n\tsend(request:CyakoRequest){\n\t\tif (this.isConnected){\n\t\t\tthis.websocket.send(JSON.stringify(request));\n\t\t}\n\t}\n\tconnect(){\n\t\treturn new Promise((resolve,reject) => {\n\t\t\tif (!this.websocket || this.websocket.readyState===3){\n\t\t\t\tthis.websocket = new WebSocket(this.url);\n\t\t\t\tinterface ReceivedData {\n\t\t\t\t\tdata:string\n\t\t\t\t}\n\t\t\t\tthis.websocket.onmessage = (data:ReceivedData) =>{\n\t\t\t\t\tlet response = JSON.parse(data.data);\n   \t\t \t\t\tthis.receiver.resolve(response);\n\t\t\t\t}\t\n    \t\t\tthis.websocket.onclose = () =>{\n\t\t\t\t\tconsole.info(\"Closed.\")\n    \t\t\t};\n   \t\t    \tthis.websocket.onerror = () =>{\n\t\t\t\t\tconsole.info(\"Errord.\")\n   \t\t    \t};\n\t\t\t\tthis.websocket.onopen = () => {\n\t\t\t\t\t// this.socketCallback(this.websocket)\n\t\t\t\t\tconsole.info(\"Connected.\")\n\t\t\t\t\tresolve();\n\t\t\t\t}\n  \t\t  \t}else{\n  \t\t  \t\treject();\n  \t\t  \t};\n\t\t});\n\t}\n\tisConnected(){\n\t\treturn this.websocket && this.websocket.readyState === 1;\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/socket.ts\n **/"],"sourceRoot":""}