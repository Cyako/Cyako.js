{"version":3,"sources":["webpack:///webpack/bootstrap 41a374589136bcc8c058","webpack:///./src/pack.js","webpack:///./src/instance.ts","webpack:///./src/request.ts","webpack:///./src/task.ts","webpack:///./src/queue.ts","webpack:///./src/sender.ts","webpack:///./src/receiver.ts","webpack:///./src/socket.ts"],"names":[],"mappings":"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","file":"./dist/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 41a374589136bcc8c058\n **/","window.Cyako = require(\"./instance\").CyakoInstance;\nwindow.cyako = require(\"./instance\").CyakoInstance;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/pack.js\n ** module id = 0\n ** module chunks = 0\n **/","import {CyakoRequest} from './request';\nimport {CyakoFetchTask,CyakoListenTask} from './task';\nimport {CyakoQueue} from './queue';\nimport {CyakoSender} from './sender';\nimport {CyakoReceiver} from './receiver';\nimport {CyakoSocket} from './socket';\n\nexport class CyakoInstance {\n    // public websocket;\n    public url: string;\n    private queue: CyakoQueue;\n    private receiver: CyakoReceiver;\n    private sender: CyakoSender;\n    private socket: CyakoSocket;\n    private index: number;\n    constructor(url:string) {\n        this.url=url;\n    \tthis.queue = new CyakoQueue();\n    \tthis.receiver = new CyakoReceiver(this.queue);\n    \tthis.socket = new CyakoSocket(this.url,this.receiver,this.queue);\n    \tthis.sender = new CyakoSender(this.queue,this.socket);\n        this.index = 0;\n    };\n\n    // API\n    fetch(method:string,params:Object,data:Object){\n        let request = new CyakoRequest(method,params,data);\n        request.setId('#' + this.index++ + ':' + method);\n        return new Promise((resolve, reject) => {\n            let task = new CyakoFetchTask(request, resolve, reject);\n            this.queue.add(task);\n            this.sender.send();\n        });\n    }\n\n    listen(method: string, params: Object, data: Object) {\n        let request = new CyakoRequest(method, params, data);\n        request.setId('#' + this.index++ + ':' + method);\n        return new CyakoListenHandler(this.queue, (ack: Function, resolve: Function, reject: Function) => {\n            let task = new CyakoListenTask(request, ack, resolve, reject);\n            this.queue.add(task);\n            this.sender.send();\n            return task;\n        })\n    }\n}\n\nclass CyakoListenHandler{\n    public queue: CyakoQueue;\n    public task: CyakoListenTask;\n    public fn: Function;\n    constructor(queue:CyakoQueue,fn:Function){\n        this.queue = queue;\n        this.fn = fn;\n    }\n    then(ack:Function,resolve:Function,reject:Function){\n        // remove the previos task from the queue\n        this.cancel();\n        this.task = this.fn(ack,resolve,reject);\n    }\n    pause(){\n        this.task && this.task.pause();\n    }\n    resume(){\n        this.task && this.task.resume();\n    }\n    cancel(){\n        this.task && this.queue.setFinished(this.task.id);\n    }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/instance.ts\n **/","export class CyakoRequest{\n\tpublic id: string;\n\tpublic method: string;\n\tpublic params: Object;\n\tpublic data: Object;\n\tconstructor(method:string, params:Object, data:Object){\n\t\tthis.method = method,\n\t\tthis.params = params,\n\t\tthis.data = data\n\t}\n\tsetId(id:string){\n\t\tthis.id = id;\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/request.ts\n **/","import {CyakoRequest} from './request';\nimport {CyakoResponse} from './response';\n\nexport interface CyakoTask{\n\t// id: string\n\t// handle()\n\tid:string;\n\thandle(response:CyakoResponse):any;\n}\n\nexport class CyakoFetchTask implements CyakoTask{\n\tpublic id: string;\n\tpublic request: CyakoRequest;\n\tpublic onresolve: Function;\n\tpublic onreject: Function;\n\tconstructor(request: CyakoRequest, resolve: Function, reject: Function) {\n\t\tthis.id = request.id;\n\t\tthis.request = request;\n\t\tthis.onresolve = resolve;\n\t\tthis.onreject = reject;\n\t}\n\thandle(response:CyakoResponse) {\n\t\tthis.onresolve(response);\n\t}\n}\n\nexport class CyakoListenTask implements CyakoTask{\n\tpublic id: string;\n\tpublic request: CyakoRequest;\n\tpublic onresolve: Function;\n\tpublic onreject: Function;\n\tpublic onack: Function;\n\tpublic expectAck: boolean;\n\tpublic accecptResponse: boolean;\n\tconstructor(request: CyakoRequest,ack: Function, resolve: Function, reject: Function) {\n\t\tthis.id = request.id;\n\t\tthis.request = request;\n\t\tthis.onresolve = resolve;\n\t\tthis.onreject = reject;\n\t\tthis.onack = ack;\n\t\tthis.expectAck = true;\n\t\tthis.accecptResponse = true;\n\t}\n\thandle(response: CyakoResponse) {\n\t\tif(this.accecptResponse) {\n\t\t\tif (this.expectAck) {\n\t\t\t\tthis.onack(response);\n\t\t\t\tthis.expectAck = false;\n\t\t\t\t// if (response.isAckOk === 'ok') {\t\n\t\t\t\t// }\n\t\t\t} else {\n\t\t\t\tthis.onresolve(response);\n\t\t\t}\n\t\t}\n\t}\n\tpause() {\n\t\tthis.accecptResponse = false;\n\t}\n\tresume() {\n\t\tthis.accecptResponse = false;\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/task.ts\n **/","import {CyakoTask,CyakoListenTask} from \"./task\";\n\nexport class CyakoQueue{\n\tpublic unsent: any;\n\tpublic sent: any;\n\tconstructor(){\n\t\tthis.unsent = new Map();\n\t\tthis.sent = new Map();\n\t\t// this.finished = new Map();\n\t}\n\tadd(task:CyakoTask){\n\t\tthis.unsent.set(task.id,task);\n\t}\n\tget(taskId:string){\n\t\treturn this.sent.get(taskId);\n\t}\n\tsetSent(taskId:string){\n\t\tif (this.unsent.has(taskId)){\n\t\t\tthis.sent.set(taskId,this.unsent.get(taskId));\n\t\t\tthis.unsent.delete(taskId)\n\t\t}\n\t}\n\tsetFinished(taskId:string){\n\t\tif (this.sent.has(taskId)) {\n\t\t\tthis.sent.delete(taskId)\n\t\t}\n\t}\n\tclean(){\n\t\tlet timeout = 10000;\n\t\tlet op = (sent:any) => {\n\t\t\tlet entries = sent.entries(); \n\t\t\tlet item = entries.next();\n\t\t\twhile(!item.done){\n\t\t\t\tlet task = item.value;\n\t\t\t\tif (task.isTimeout()) {\n\t\t\t\t\tsent.delete(item.key)\n\t\t\t\t}\n\t\t\t\titem = entries.next();\n\t\t\t}\n\t\t};\n\t\tsetTimeout(()=>{\n\t\t\top(this.sent);\n\t\t},timeout)\n\t}\n\tisNeedReconnect(){\n\t\tlet entries = this.sent.entries();\n\t\tlet item = entries.next();\n\t\twhile(!item.done){\n\t\t\tlet task = item.value;\n\t\t\tif(task instanceof CyakoListenTask){\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t\treturn false\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/queue.ts\n **/","import {CyakoQueue} from \"./queue\";\nimport {CyakoSocket} from \"./socket\";\n\nexport class CyakoSender {\n\tprivate queue: CyakoQueue;\n\tprivate socket: CyakoSocket;\n\tconstructor(queue:CyakoQueue,socket:CyakoSocket){\n\t\tthis.queue = queue;\n\t\tthis.socket = socket;\n\t}\n\tsend(){\n\t\tlet sendUnsent = () => {\n\t\t\tlet entries = this.queue.unsent.entries();\n\t\t\tlet item = entries.next();\n\t\t\twhile(!item.done){\n\t\t\t\tlet task = item.value[1];\n\t\t\t\tthis.socket.send(task.request);\n\t\t\t\tthis.queue.setSent(task.id);\n\t\t\t\titem = entries.next();\n\t\t\t}\n\t\t};\n\t\tif (this.socket.isConnected()){\n\t\t\tsendUnsent();\n\t\t}else{\n\t\t\tthis.socket.connect().then(ok=>{\n\t\t\t\tsendUnsent();\n\t\t\t},err=>{});\n\t\t}\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/sender.ts\n **/","import {CyakoQueue} from './queue';\nimport {CyakoTask,CyakoFetchTask,CyakoListenTask} from './task';\nimport {CyakoResponse} from './response';\n\nexport class CyakoReceiver{\n\tprivate queue: CyakoQueue;\n\tconstructor(queue:CyakoQueue){\n\t\tthis.queue = queue;\n\t}\n\tresolve(response:CyakoResponse){\n\t\tlet id = response.id;\n\t\tlet task: CyakoTask;\n\t\ttask = this.queue.get(id);\n\t\tif(task) {\n\t\t\ttask.handle(response);\n\t\t\tif(task instanceof CyakoFetchTask) {\n\t\t\t\tthis.queue.setFinished(task.id);\n\t\t\t}\n\t\t}\n\t};\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/receiver.ts\n **/","import {CyakoReceiver} from './receiver';\nimport {CyakoRequest} from './request';\nimport {CyakoQueue} from './queue';\n\n\nexport class CyakoSocket{\n\tpublic url: string;\n\tprivate receiver: CyakoReceiver;\n\tprivate queue:CyakoQueue;\n\tprivate websocket: WebSocket;\n\tconstructor(url:string,receiver:CyakoReceiver,queue:CyakoQueue){\n\t\tthis.url = url;\n\t\tthis.receiver = receiver;\n\t\tthis.queue = queue;\n\t}\n\tsend(request:CyakoRequest){\n\t\tif (this.isConnected){\n\t\t\tthis.websocket.send(JSON.stringify(request));\n\t\t}\n\t}\n\tconnect(){\n\t\treturn new Promise((resolve,reject) => {\n\t\t\tif (!this.websocket || this.websocket.readyState===3){\n\t\t\t\tthis.websocket = new WebSocket(this.url);\n\t\t\t\tinterface ReceivedData {\n\t\t\t\t\tdata:string\n\t\t\t\t}\n\t\t\t\tthis.websocket.onmessage = (data:ReceivedData) =>{\n\t\t\t\t\tlet response = JSON.parse(data.data);\n   \t\t \t\t\tthis.receiver.resolve(response);\n\t\t\t\t}\n    \t\t\tthis.websocket.onclose = () =>{\n\t\t\t\t\tconsole.info(\"Closed.\")\n\t\t\t\t\tif(this.queue.isNeedReconnect()) {\n\t\t\t\t\t\tthis.connect();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.websocket.onerror = () =>{\n\t\t\t\t\tconsole.info(\"Errord.\")\n\t\t\t\t};\n\t\t\t\tthis.websocket.onopen = () => {\n\t\t\t\t\tconsole.info(\"Connected.\")\n\t\t\t\t\tresolve();\n\t\t\t\t}\n  \t\t  \t}else{\n  \t\t  \t\treject();\n  \t\t  \t};\n\t\t});\n\t}\n\tisConnected(){\n\t\treturn this.websocket && this.websocket.readyState === 1;\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/socket.ts\n **/"],"sourceRoot":""}